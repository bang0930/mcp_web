name: Sync fork on main push

on:
  push:
    branches:
      - main   # 조직 레포 main에 커밋/머지될 때마다 실행

jobs:
  sync-fork:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # 조직 레포 읽을 권한만 사용 (실제 push는 PAT로)

    steps:
      - name: Checkout org repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false  # github-actions[bot] 자격증명 사용 안 함

      - name: Push main to fork main
        env:
          FORK_SYNC_PAT: ${{ secrets.FORK_SYNC_PAT }}
        run: |
          # 포크 레포를 새로운 remote로 추가
          git remote add fork "https://bang0930:${FORK_SYNC_PAT}@github.com/bang0930/mcp_web.git"

          # 포크 main을 조직 main으로 강제 맞춤
          git push --force fork HEAD:main
